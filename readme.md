# Project2 说明文档

卞雨喆 18307110428

## 1 项目完成情况

所有需求全部完成了。

## 2 Bonus完成情况

三项bonus均做。

1. 哈希加盐：

	1. 使用了前后两个盐，整体再次哈希。

		```php
		 $finalpasss = "'".md5($salt2.$pass.$salt1)."'";
		```

	2. 其中，前缀盐是随机生成的，存储在数据库另列的一项Salt。

		```php
		// 2号盐，前缀，随机生成的存在数据库的。
		function Hashsalt2(){
		    $intermediateSalt = md5(uniqid(rand(mt_rand(),true)));
		    $salt = substr($intermediateSalt, 0, 6);
		    $salt = substr(md5($salt),0,6);
		    return $salt;
		}
		```

	2. 后缀盐是通过密码生成的，不存储，每次需要时计算。

		```php
		function Hashsalt1($password) {
		    $x  = "";
		    $saltFromPass = "";
		    for($i = strlen($password)-1; $i >= 0; $i--){
		        $x .= substr($password,$i,1);
		        $saltFromPass .= $x;
		    }
		    // 1号盐：（递增倒记字符串，如1234-> 4434324321）的前五位的 md5 哈希
		    $salt = md5(substr($saltFromPass,0,5));
		    return $salt;
		}
		```

![image-20200621140220203](https://gitee.com/YuzheBian/assets/raw/master/img/image-20200621140220203.png)



2. 部署网站：

	⏬

	http://www.bianyuzhe.com/

	服务器是阿里云免费发的服务器（真香），Ubuntu系统。带宽小，所以初次加载图片有些慢。

	通过ssh+FileZilla传输+phpstudy辅助运维建站。

	域名已经备案并解析，备案号<u>苏ICP备20030033号-1</u>。



3. 现代前端框架与技术
	1. 使用Vue，重点使用了**属性绑定**和**组件化应用构建功能**。

		每一个页面的导航栏、页脚都只需要一行代码，代替了pj1中很长的含矢量图html句块，可读性增强的同时，可以在有更改需求时只更改一处实现同步。

	```html
	<nav_left></nav_left>
	<component v-bind:is="whichcomp"></component>
	```

	 	   好像还要写心得，那我就再多写两句hh

	​		我们目前大概只需要Vue.js的功能就行了，组件化应用构建和Vue实例的一些复用性功能应该是很实用的，省去了写关系函数的时间，而且可以js的其他部分对接。

	​	    新学习一个框架确实需要一些学习成本，可能在一开始显得拖进度或者浪费时间。但是一旦成功就能在未来节省更多时间。

	​		脚手架似乎更加适合对于单页大型应用的架构。

	2. 所有CSS都是通过SaSS预处理器语言写的，通过“布局单位”、“字体合集”、“模块外观”等局部文件组织样式、组织变量、嵌套响应式、混入等功能，使CSS的设计复用性强、逻辑性强，易于重用与增删改查。

	3. 调用了jQuery库，配合JS使用。
	4. PS:在一开始做Vue.cli时使用了npm等库管理工具，但是问了助教说小网站也不太需要脚手架，就没有继续使用了。



## 3 建议与意见

知识系统很大，信息量也很多。但是不知道考试到底想要重点考察哪些部分，因为很多地方老师说“更多内容可以去看书”，所以复习起来比较迷茫。

希望能对知识点有一个提点，还有就是考试可以给一些必要的函数名称啥的？（php函数好多名字诡异记不住呀）



## 4 PJ2完成中的问题及解决方案

1. 单双引号的php混入写法问题，常常导致数据库写不进、输出有问题等bug。

	【解决方案】

	尽可能使用定界符；

	确保sql语句的值外有引号；

	对于直接写入元素内的可以直接`<?php echo $value ?>`,省心

	对于无法避免的单双引号造成错误断句问题，实在不行可以使用`str_replace("\"","'",$x)`，使引号插入时填入一个转义符。

2. 上传界面的国家城市二级联动与提交，数据太大，而且很多城市带“ ' '”前缀。

	【解决方案】

	首先爬取了数据库里的国家城市名，用一个大型变量的名值对形式存储。

	根据群内同学的建议，使用单引号+js而非其他格式形式的数据存储，提升了读取效率；

	所有带单引号的城市名称加入转义符。

	在提交sql语录时注意和问题1中一样的情况，如果有转移需要可以插入转义符。

3. 哈希加盐时，出现存储和登录不匹配的问题

	【解决方案】猜测是因为单引号（又是它，烦死了），因为前两个问题导致多加了单引号进行md5散列哈希，所以产生差异。确保两段代码的书写一致性即可。

4. 首页随机刷新图片时出现空白问题

	【解决方案】发现是原因是数据库没有ImageID=79的图片。而且，新增图片由于前面有删除等问题，并非是填充1~ `Count`的全部数据的。一共85条时或许后两条的ID=94，95。

	最后更改了刷新算法，用for取代while，结合随机出的排序值准确找到图片的内容。

5. 搜索时的逻辑复用

  【解决方案】提取单/多字段搜索内容，整合在同一个php文件，通过post中值区分入口。

  注意：小心sql语句中是否增加一项查询时的`and`添加和去除。

6. 修改时的逻辑问题，比如如何修改图像内容的操作

  【解决方案】判断并删除存储的前一张图片内容，并添加新图片。

  注意：input是改value，textarea直接写进去。

7. 其他奇怪的问题

  【解决方案】

  先自己看代码，我常用`echo "<script>console.log(".$x.")</script>" `这样奇怪的方式看变量hh

  或者查书和google，实在不行再问同学和助教。

